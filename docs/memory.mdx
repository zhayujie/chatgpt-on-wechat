---
title: 长期记忆
description: CowAgent 的长期记忆系统
---

记忆系统让 Agent 能够长期记住重要信息，在对话中不断积累经验、理解用户偏好，真正实现自主思考和持续成长。

## 工作原理

Agent 会在以下场景主动存储记忆：

- **用户分享重要信息时** — 自动识别偏好、决策、事实等关键信息并存储
- **对话达到一定长度时** — 自动提取摘要，避免信息丢失
- **需要检索时** — 智能搜索历史记忆，结合上下文进行回答

## 记忆类型

### 核心记忆

存储在 `~/cow/memory/core.md` 中，包含用户的长期偏好、重要决策、关键事实等不会随时间淡化的信息。

### 天级记忆

存储在 `~/cow/memory/daily/` 目录下，按日期组织，记录每天的对话摘要和关键事件。

## 首次启动

首次启动 Agent 时，Agent 会主动向用户询问关键信息，并记录至工作空间（默认 `~/cow`）中：

| 文件 | 说明 |
| --- | --- |
| `system.md` | Agent 的系统提示词和行为设定 |
| `user.md` | 用户身份信息和偏好 |
| `memory/core.md` | 核心记忆 |
| `memory/daily/` | 天级记忆目录 |

<Frame>
  <img src="https://cdn.link-ai.tech/doc/20260203000455.png" width="800" />
</Frame>

## 记忆检索

记忆系统支持混合检索模式：

- **关键词检索** — 基于关键词匹配历史记忆
- **向量检索** — 基于语义相似度搜索，即使表述不同也能找到相关记忆

Agent 会在对话中根据需要自动触发记忆检索，将相关历史信息纳入上下文。

## 相关配置

```json
{
  "agent_workspace": "~/cow",
  "agent_max_context_tokens": 40000,
  "agent_max_context_turns": 30
}
```

| 参数 | 说明 | 默认值 |
| --- | --- | --- |
| `agent_workspace` | 工作空间路径，记忆文件存储在此目录下 | `~/cow` |
| `agent_max_context_tokens` | 最大上下文 token 数，影响短期记忆容量 | `40000` |
| `agent_max_context_turns` | 最大上下文轮次，超出后自动丢弃最早对话 | `30` |
