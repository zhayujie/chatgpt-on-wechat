<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç™»å½•</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .login-container {
    background: rgba(255, 255, 255, 0.95);
    padding: 2.5rem 3rem;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    width: 100%;
    max-width: 400px;
  }
  h2 {
    margin-bottom: 1.5rem;
    color: #333;
    text-align: center;
  }
  form {
    display: flex;
    flex-direction: column;
  }
  label {
    font-weight: 600;
    margin-bottom: 0.4rem;
    color: #444;
  }
  input[type="text"],
  input[type="email"],
  input[type="password"] {
    padding: 0.6rem 0.8rem;
    font-size: 1rem;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    transition: border-color 0.3s ease;
    outline-offset: 2px;
  }
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="password"]:focus {
    border-color: #667eea;
  }
  .password-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }
  .toggle-password {
    position: absolute;
    right: 0.8rem;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    color: #667eea;
    user-select: none;
  }
  .login-button {
    margin-top: 1.5rem;
    padding: 0.75rem;
    font-size: 1.1rem;
    font-weight: 700;
    background-color: #667eea;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .login-button:disabled {
    background-color: #a3a9f7;
    cursor: not-allowed;
  }
  .forgot-password {
    margin-top: 1rem;
    text-align: right;
  }
  .forgot-password a {
    color: #667eea;
    text-decoration: none;
    font-size: 0.9rem;
  }
  .forgot-password a:hover {
    text-decoration: underline;
  }
  .error-message {
    margin-top: 1rem;
    color: #d93025;
    font-weight: 600;
    text-align: center;
  }
  .loading-spinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    display: inline-block;
    vertical-align: middle;
    margin-left: 8px;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
  /* Responsive */
  @media (max-width: 480px) {
    .login-container {
      margin: 1rem;
      padding: 2rem 1.5rem;
    }
  }
</style>
</head>
<body>
  <div class="login-container" role="main" aria-label="ç™»å½•è¡¨å•">
    <h2>ç”¨æˆ·ç™»å½•</h2>
    <form id="loginForm" novalidate>
      <label for="usernameEmail">ç”¨æˆ·åæˆ–é‚®ç®±</label>
      <input type="text" id="usernameEmail" name="usernameEmail" autocomplete="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±" required aria-describedby="usernameEmailError" />
      <div id="usernameEmailError" class="error-message" aria-live="polite"></div>

      <label for="password" style="margin-top:1rem;">å¯†ç </label>
      <div class="password-wrapper">
        <input type="password" id="password" name="password" autocomplete="current-password" placeholder="è¯·è¾“å…¥å¯†ç " required minlength="6" aria-describedby="passwordError" />
        <button type="button" class="toggle-password" aria-label="åˆ‡æ¢å¯†ç å¯è§æ€§" title="åˆ‡æ¢å¯†ç å¯è§æ€§">ğŸ‘ï¸</button>
      </div>
      <div id="passwordError" class="error-message" aria-live="polite"></div>

      <button type="submit" id="loginButton" class="login-button" disabled>ç™»å½•</button>
      <div class="forgot-password">
        <a href="/forgot-password.html" target="_blank" rel="noopener noreferrer">å¿˜è®°å¯†ç ï¼Ÿ</a>
      </div>
      <div id="submitError" class="error-message" aria-live="polite"></div>
    </form>
  </div>

<script>
  (function(){
    const usernameEmailInput = document.getElementById('usernameEmail');
    const passwordInput = document.getElementById('password');
    const loginButton = document.getElementById('loginButton');
    const usernameEmailError = document.getElementById('usernameEmailError');
    const passwordError = document.getElementById('passwordError');
    const submitError = document.getElementById('submitError');
    const togglePasswordBtn = document.querySelector('.toggle-password');
    const form = document.getElementById('loginForm');

    // æ ¡éªŒç”¨æˆ·åæˆ–é‚®ç®±æ ¼å¼
    function validateUsernameEmail(value) {
      if (!value.trim()) {
        return "ç”¨æˆ·åæˆ–é‚®ç®±ä¸èƒ½ä¸ºç©º";
      }
      // ç®€å•é‚®ç®±æ­£åˆ™
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      // ç”¨æˆ·åè§„åˆ™ï¼šå…è®¸å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼Œé•¿åº¦3-20
      const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
      if (emailRegex.test(value)) {
        return "";
      } else if (usernameRegex.test(value)) {
        return "";
      } else {
        return "è¯·è¾“å…¥æœ‰æ•ˆçš„ç”¨æˆ·åæˆ–é‚®ç®±æ ¼å¼";
      }
    }

    // æ ¡éªŒå¯†ç æ ¼å¼
    function validatePassword(value) {
      if (!value) {
        return "å¯†ç ä¸èƒ½ä¸ºç©º";
      }
      if (value.length < 6) {
        return "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½";
      }
      return "";
    }

    // å®æ—¶æ ¡éªŒå¹¶æ›´æ–°é”™è¯¯æç¤ºå’ŒæŒ‰é’®çŠ¶æ€
    function validateForm() {
      const usernameEmailVal = usernameEmailInput.value;
      const passwordVal = passwordInput.value;

      const usernameEmailErrMsg = validateUsernameEmail(usernameEmailVal);
      const passwordErrMsg = validatePassword(passwordVal);

      usernameEmailError.textContent = usernameEmailErrMsg;
      passwordError.textContent = passwordErrMsg;
      submitError.textContent = "";

      const isValid = !usernameEmailErrMsg && !passwordErrMsg;
      loginButton.disabled = !isValid;
      return isValid;
    }

    // å¯†ç å¯è§åˆ‡æ¢
    togglePasswordBtn.addEventListener('click', () => {
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        togglePasswordBtn.textContent = 'ğŸ™ˆ';
        togglePasswordBtn.setAttribute('aria-label', 'éšè—å¯†ç ');
        togglePasswordBtn.setAttribute('title', 'éšè—å¯†ç ');
      } else {
        passwordInput.type = 'password';
        togglePasswordBtn.textContent = 'ğŸ‘ï¸';
        togglePasswordBtn.setAttribute('aria-label', 'æ˜¾ç¤ºå¯†ç ');
        togglePasswordBtn.setAttribute('title', 'æ˜¾ç¤ºå¯†ç ');
      }
    });

    // ç›‘å¬è¾“å…¥äº‹ä»¶å®æ—¶æ ¡éªŒ
    usernameEmailInput.addEventListener('input', validateForm);
    passwordInput.addEventListener('input', validateForm);

    // æ¨¡æ‹Ÿç™»å½•è¯·æ±‚
    function fakeLoginRequest(data) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          // æ¨¡æ‹Ÿç”¨æˆ·å/é‚®ç®±ä¸º "user" æˆ– "user@example.com" ä¸”å¯†ç ä¸º "password123" æ‰æˆåŠŸ
          const validUsers = ["user", "user@example.com"];
          if (validUsers.includes(data.usernameEmail.toLowerCase()) && data.password === "password123") {
            resolve();
          } else {
            reject(new Error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"));
          }
        }, 1500);
      });
    }

    // è¡¨å•æäº¤å¤„ç†
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!validateForm()) return;

      loginButton.disabled = true;
      const originalText = loginButton.textContent;
      loginButton.textContent = "ç™»å½•ä¸­";
      const spinner = document.createElement('span');
      spinner.className = 'loading-spinner';
      loginButton.appendChild(spinner);
      submitError.textContent = "";

      try {
        await fakeLoginRequest({
          usernameEmail: usernameEmailInput.value.trim(),
          password: passwordInput.value
        });
        // ç™»å½•æˆåŠŸè·³è½¬ï¼ˆæ­¤å¤„ç”¨alertæ¨¡æ‹Ÿï¼‰
        alert("ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ç”¨æˆ·ä¸»é¡µ");
        // window.location.href = "/user-home.html"; // å®é™…è·³è½¬
      } catch (err) {
        submitError.textContent = err.message;
      } finally {
        loginButton.disabled = false;
        loginButton.textContent = originalText;
      }
    });

    // é¡µé¢åŠ è½½æ—¶æ ¡éªŒä¸€æ¬¡ï¼Œé˜²æ­¢ç¼“å­˜å€¼å¯¼è‡´æŒ‰é’®çŠ¶æ€å¼‚å¸¸
    validateForm();
  })();
<\/script>
<\/body>
<\/html>
